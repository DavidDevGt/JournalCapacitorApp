digraph SentimentAnalysisFlow {
    rankdir=TB;
    node [shape=box, style=filled, color="#e0e0e0", fontname="Arial"];

    InputText [label="ðŸ“ Input Text", fillcolor="#ffccff"];
    CheckCache [label="ðŸ§  Â¿En Cache?", shape=diamond, fillcolor="#ffffcc"];
    ReturnCached [label="ðŸ” Return Cached Result", fillcolor="#ccffcc"];
    Preprocess [label="ðŸ§¼ Preprocess Text\n(lowercase, clean)", fillcolor="#ffffff"];
    Tokenize [label="âœ‚ï¸ Tokenize Words"];
    CheckMinWords [label="ðŸ” Â¿Min. Words >= Threshold?", shape=diamond];
    ReturnDefault [label="âšª Return Default Result", fillcolor="#ffcccc"];
    
    %% ConfiguraciÃ³n de Sensibilidad
    CheckSensitivity [label="âš™ï¸ Obtener ConfiguraciÃ³n\nSensibilidad", fillcolor="#e6f3ff"];
    SetConfidenceThreshold [label="ðŸ“ Ajustar Threshold\nBasado en Sensibilidad", fillcolor="#e6f3ff"];
    
    ScoreHeuristic [label="ðŸ§® Heuristic Scoring\n(SentimentWords, Negaciones, Intensificadores)"];
    ScoreBayes [label="ðŸ“Š Bayes Prediction\n(Naive Bayes)"];
    DetectEmotions [label="â¤ï¸ Detect Emotions\n(keyword matching)"];
    CombineScores [label="âš–ï¸ Combine Scores\n(0.7 Heuristic + 0.3 Bayes)"];
    CalculateConfidence [label="ðŸ“ Calculate Confidence"];
    
    %% VerificaciÃ³n de SelecciÃ³n Manual
    CheckManualSelection [label="ðŸ‘† Â¿SelecciÃ³n Manual\nActiva?", shape=diamond, fillcolor="#ffe6cc"];
    SkipAutoDetection [label="â­ï¸ Saltar DetecciÃ³n\nAutomÃ¡tica", fillcolor="#ffe6cc"];
    
    MapEmoji [label="ðŸ˜Š Map Score to Emoji"];
    BuildResult [label="ðŸ§± Build Final Result"];
    SaveCache [label="ðŸ’¾ Save in Cache"];
    CleanupCache [label="ðŸ§¹ Limpiar Cache\nSi excede lÃ­mite", fillcolor="#f0f0f0"];
    ReturnResult [label="ðŸ“¤ Return Final Result", fillcolor="#ccccff"];

    // Connections
    InputText -> CheckCache;
    CheckCache -> ReturnCached [label="âœ… SÃ­"];
    CheckCache -> Preprocess [label="âŒ No"];
    Preprocess -> Tokenize;
    Tokenize -> CheckMinWords;
    CheckMinWords -> ReturnDefault [label="âŒ No"];
    CheckMinWords -> CheckSensitivity [label="âœ… SÃ­"];
    
    CheckSensitivity -> SetConfidenceThreshold;
    SetConfidenceThreshold -> ScoreHeuristic;
    
    ScoreHeuristic -> ScoreBayes;
    ScoreBayes -> DetectEmotions;
    DetectEmotions -> CombineScores;
    CombineScores -> CalculateConfidence;
    CalculateConfidence -> CheckManualSelection;
    
    CheckManualSelection -> SkipAutoDetection [label="âœ… SÃ­"];
    CheckManualSelection -> MapEmoji [label="âŒ No"];
    
    SkipAutoDetection -> ReturnResult;
    MapEmoji -> BuildResult;
    BuildResult -> SaveCache;
    SaveCache -> CleanupCache;
    CleanupCache -> ReturnResult;
}
