graph TD
    A[ðŸ“± Inicio de la App] --> B{Validar Entorno}
    B -->|âŒ Falla| C[ðŸš¨ Manejo de Error de InicializaciÃ³n]
    B -->|âœ… VÃ¡lido| D[ðŸ”„ Mostrar Loading]
    
    D --> E[ðŸ”§ Inicializar MÃ³dulos]
    E --> F[ðŸ“± Capacitor]
    E --> G[ðŸ—„ï¸ Base de Datos]
    E --> H[ðŸŽ¨ UI]
    E --> I[ðŸ“ Journal]
    
    F --> J[âš™ï¸ Configurar Listeners de Capacitor]
    G --> K[ðŸ’¾ Conectar BD]
    H --> L[ðŸŒ™ Cargar Preferencias Dark Mode]
    I --> M[ðŸ“– Preparar Sistema de Escritura]
    
    J --> N[ðŸŽ¯ Configurar UI Core]
    K --> N
    L --> N
    M --> N
    
    N --> O[ðŸ“… NavegaciÃ³n de Calendario]
    N --> P[ðŸ” Sistema de BÃºsqueda]
    N --> Q[ðŸŒ™ Toggle Dark Mode]
    N --> R[âŒ¨ï¸ Atajos de Teclado]
    N --> S[ðŸ“‹ MenÃº Principal]
    
    O --> T[ðŸŽ§ Event Listeners]
    P --> T
    Q --> T
    R --> T
    S --> T
    
    T --> U[ðŸ“± PWA Features]
    U --> V[ðŸ“² InstalaciÃ³n PWA]
    U --> W[ðŸ“¶ DetecciÃ³n Offline]
    
    V --> X[ðŸŽ‰ Finalizar InicializaciÃ³n]
    W --> X
    
    X --> Y[ðŸš€ App Lista]
    Y --> Z[ðŸ”„ Ciclo de Vida Activo]
    
    %% Flujo de Interacciones Principales
    Z --> AA{Usuario InteractÃºa}
    AA -->|Menu| BB[ðŸ“‹ Mostrar MenÃº]
    AA -->|Escribir| CC[âœï¸ Editor de Texto]
    AA -->|Buscar| DD[ðŸ” Buscar Entradas]
    AA -->|Navegar| EE[ðŸ“… Cambiar Fecha]
    
    BB --> FF{OpciÃ³n del MenÃº}
    FF -->|Stats| GG[ðŸ“Š Mostrar EstadÃ­sticas]
    FF -->|Settings| HH[âš™ï¸ Configuraciones]
    FF -->|Export| II[ðŸ“¤ Exportar Datos]
    FF -->|About| JJ[â„¹ï¸ InformaciÃ³n]
    
    CC --> KK[ðŸ’¾ Autoguardado]
    DD --> LL[ðŸ“‹ Resultados Filtrados]
    EE --> MM[ðŸ”„ Actualizar Vista]
    
    GG --> NN[ðŸ“Š Calcular Stats del Journal]
    HH --> OO[âš™ï¸ Modal de ConfiguraciÃ³n]
    II --> PP[ðŸ“ Generar Archivo de ExportaciÃ³n]
    JJ --> QQ[â„¹ï¸ Modal Informativo]
    
    KK --> RR[ðŸ—„ï¸ Persistir en BD]
    LL --> SS[ðŸŽ¨ Renderizar UI]
    MM --> TT[ðŸ“… Actualizar Calendario]
    
    %% GestiÃ³n de Estados y Errores
    NN --> UU[ðŸ“± Modal de Stats]
    OO --> VV[ðŸ’¾ Guardar Preferencias]
    PP --> WW[ðŸ’¾ Descargar Archivo]
    QQ --> XX[ðŸ“± Modal About]
    
    RR --> YY{Â¿Error de BD?}
    YY -->|âŒ SÃ­| ZZ[ðŸš¨ Mostrar Error]
    YY -->|âœ… No| AAA[âœ… Confirmar Guardado]
    
    SS --> BBB[ðŸŽ¨ UI Actualizada]
    TT --> CCC[ðŸ“… Vista Sincronizada]
    
    UU --> DDD[âŒ Cerrar Modal]
    VV --> EEE[âš™ï¸ ConfiguraciÃ³n Aplicada]
    WW --> FFF[ðŸ“ Descarga Completa]
    XX --> GGG[âŒ Cerrar Modal]
    
    %% Cleanup y Cierre
    DDD --> Z
    EEE --> Z
    FFF --> Z
    GGG --> Z
    AAA --> Z
    BBB --> Z
    CCC --> Z
    ZZ --> Z
    
    %% Manejo de Errores Globales
    HHH[ðŸŒ Error Global] --> III[ðŸ“ Log de Error]
    III --> JJJ{Â¿Error CrÃ­tico?}
    JJJ -->|âŒ SÃ­| KKK[ðŸš¨ Reiniciar App]
    JJJ -->|âš ï¸ No| Z
    
    %% DestrucciÃ³n de la App
    Z --> LLL{Â¿Cerrar App?}
    LLL -->|âœ… SÃ­| MMM[ðŸ§¹ Cleanup]
    LLL -->|âŒ No| Z
    
    MMM --> NNN[ðŸŽ§ Remover Event Listeners]
    MMM --> OOO[ðŸ—„ï¸ Cerrar Conexiones BD]
    MMM --> PPP[ðŸ“± Cleanup Modales]
    MMM --> QQQ[ðŸ“± Cleanup Capacitor]
    
    NNN --> RRR[ðŸ’€ App Destruida]
    OOO --> RRR
    PPP --> RRR
    QQQ --> RRR
    
    %% Estilos
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    classDef process fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef decision fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef error fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff
    classDef ui fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    classDef data fill:#00BCD4,stroke:#00838F,stroke-width:2px,color:#fff
    
    class A,Y,RRR startEnd
    class B,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X process
    class AA,FF,YY,JJJ,LLL decision
    class C,ZZ,HHH,III,KKK error
    class BB,CC,DD,EE,GG,HH,II,JJ,UU,OO,QQ,XX,DDD,GGG ui
    class KK,RR,VV,WW,AAA,MMM,NNN,OOO,PPP,QQQ data