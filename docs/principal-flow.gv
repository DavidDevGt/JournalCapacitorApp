graph TD
    A[ðŸ“± Inicio de la App] --> B{Validar Entorno}
    B -->|âŒ Falla| C[ðŸš¨ Manejo de Error de InicializaciÃ³n]
    B -->|âœ… VÃ¡lido| D[ðŸ”„ Mostrar Loading]
    
    D --> E[ðŸ”§ Inicializar MÃ³dulos]
    E --> F[ðŸ“± Capacitor]
    E --> G[ðŸ—„ï¸ Base de Datos]
    E --> H[ðŸŽ¨ UI]
    E --> I[ðŸ“ Journal]
    E --> J[ðŸ”” Servicio de Notificaciones]
    E --> K[ðŸŒ Servicio de Red]
    
    F --> L[âš™ï¸ Configurar Listeners de Capacitor]
    G --> M[ðŸ’¾ Conectar BD]
    H --> N[ðŸŒ™ Cargar Preferencias Dark Mode]
    I --> O[ðŸ“– Preparar Sistema de Escritura]
    J --> P[ðŸ”” Solicitar Permisos de NotificaciÃ³n]
    K --> Q[ðŸŒ Detectar Estado de Conectividad]
    
    L --> R[ðŸŽ¯ Configurar UI Core]
    M --> R
    N --> R
    O --> R
    P --> R
    Q --> R
    
    R --> S[ðŸ“… NavegaciÃ³n de Calendario]
    R --> T[ðŸ” Sistema de BÃºsqueda]
    R --> U[ðŸŒ™ Toggle Dark Mode]
    R --> V[âŒ¨ï¸ Atajos de Teclado]
    R --> W[ðŸ“‹ MenÃº Principal]
    R --> X[ðŸ“· Funcionalidades de CÃ¡mara]
    R --> Y[ðŸ”” Configurar Notificaciones]
    R --> Z[ðŸŒ Monitorear Conectividad]
    
    S --> AA[ðŸŽ§ Event Listeners]
    T --> AA
    U --> AA
    V --> AA
    W --> AA
    X --> AA
    Y --> AA
    Z --> AA
    
    AA --> BB[ðŸ“± PWA Features]
    BB --> CC[ðŸ“² InstalaciÃ³n PWA]
    BB --> DD[ðŸ“¶ DetecciÃ³n Offline]
    
    CC --> EE[ðŸŽ‰ Finalizar InicializaciÃ³n]
    DD --> EE
    
    EE --> FF[ðŸš€ App Lista]
    FF --> GG[ðŸ”„ Ciclo de Vida Activo]
    
    %% Flujo de Interacciones Principales
    GG --> HH{Usuario InteractÃºa}
    HH -->|Menu| II[ðŸ“‹ Mostrar MenÃº]
    HH -->|Escribir| JJ[âœï¸ Editor de Texto]
    HH -->|Buscar| KK[ðŸ” Buscar Entradas]
    HH -->|Navegar| LL[ðŸ“… Cambiar Fecha]
    HH -->|Foto| MM[ðŸ“· Tomar/Seleccionar Foto]
    HH -->|Compartir| NN[ðŸ“¤ Compartir Entrada]
    
    II --> OO{OpciÃ³n del MenÃº}
    OO -->|Stats| PP[ðŸ“Š Mostrar EstadÃ­sticas]
    OO -->|Settings| QQ[âš™ï¸ Configuraciones]
    OO -->|Export| RR[ðŸ“¤ Exportar Datos]
    OO -->|Import| SS[ðŸ“¥ Importar Datos]
    OO -->|About| TT[â„¹ï¸ InformaciÃ³n]
    
    JJ --> UU[ðŸ’¾ Autoguardado]
    JJ --> VV[ðŸ§  AnÃ¡lisis AutomÃ¡tico de Sentimientos]
    KK --> WW[ðŸ“‹ Resultados Filtrados]
    LL --> XX[ðŸ”„ Actualizar Vista]
    MM --> YY[ðŸ“¸ Procesar Foto]
    NN --> ZZ[ðŸ“¤ Preparar Datos para Compartir]
    
    PP --> AAA[ðŸ“Š Calcular Stats del Journal]
    QQ --> BBB[âš™ï¸ Modal de ConfiguraciÃ³n]
    RR --> CCC[ðŸ“ Generar Archivo de ExportaciÃ³n]
    SS --> DDD[ðŸ“ Procesar Archivo de ImportaciÃ³n]
    TT --> EEE[â„¹ï¸ Modal Informativo]
    
    UU --> FFF[ðŸ—„ï¸ Persistir en BD]
    VV --> GGG[ðŸ˜Š Actualizar Estado de Ãnimo]
    WW --> HHH[ðŸŽ¨ Renderizar UI]
    XX --> III[ðŸ“… Actualizar Calendario]
    YY --> JJJ[ðŸ–¼ï¸ Generar Thumbnail]
    ZZ --> KKK[ðŸ“¤ Ejecutar Compartir]
    
    %% GestiÃ³n de Estados y Errores
    AAA --> LLL[ðŸ“± Modal de Stats]
    BBB --> MMM[ðŸ’¾ Guardar Preferencias]
    CCC --> NNN[ðŸ’¾ Descargar Archivo]
    DDD --> OOO[ðŸ“¥ Importar y Validar Datos]
    EEE --> PPP[ðŸ“± Modal About]
    
    FFF --> QQQ{Â¿Error de BD?}
    QQQ -->|âŒ SÃ­| RRR[ðŸš¨ Mostrar Error]
    QQQ -->|âœ… No| SSS[âœ… Confirmar Guardado]
    
    GGG --> TTT[ðŸ˜Š UI Actualizada con Estado de Ãnimo]
    HHH --> UUU[ðŸŽ¨ UI Actualizada]
    III --> VVV[ðŸ“… Vista Sincronizada]
    JJJ --> WWW[ðŸ–¼ï¸ Thumbnail Generado]
    KKK --> XXX[ðŸ“¤ Compartir Completado]
    
    LLL --> YYY[âŒ Cerrar Modal]
    MMM --> ZZZ[âš™ï¸ ConfiguraciÃ³n Aplicada]
    NNN --> AAAA[ðŸ“ Descarga Completa]
    OOO --> BBBB[ðŸ“¥ ImportaciÃ³n Completa]
    PPP --> CCCC[âŒ Cerrar Modal]
    
    SSS --> DDDD[âœ… Confirmar Guardado]
    TTT --> EEEE[ðŸŽ¨ UI Actualizada]
    UUU --> FFFF[ðŸŽ¨ UI Actualizada]
    VVV --> GGGG[ðŸ“… Vista Sincronizada]
    WWW --> HHHH[ðŸ–¼ï¸ Thumbnail Listo]
    XXX --> IIII[ðŸ“¤ Compartir Exitoso]
    
    %% Cleanup y Cierre
    YYY --> GG
    ZZZ --> GG
    AAAA --> GG
    BBBB --> GG
    CCCC --> GG
    DDDD --> GG
    EEEE --> GG
    FFFF --> GG
    GGGG --> GG
    HHHH --> GG
    IIII --> GG
    RRR --> GG
    
    %% Manejo de Errores Globales
    JJJJ[ðŸŒ Error Global] --> KKKK[ðŸ“ Log de Error]
    KKKK --> LLLL{Â¿Error CrÃ­tico?}
    LLLL -->|âŒ SÃ­| MMMM[ðŸš¨ Reiniciar App]
    LLLL -->|âš ï¸ No| GG
    
    %% DestrucciÃ³n de la App
    GG --> NNNN{Â¿Cerrar App?}
    NNNN -->|âœ… SÃ­| OOOO[ðŸ§¹ Cleanup]
    NNNN -->|âŒ No| GG
    
    OOOO --> PPPP[ðŸŽ§ Remover Event Listeners]
    OOOO --> QQQQ[ðŸ—„ï¸ Cerrar Conexiones BD]
    OOOO --> RRRR[ðŸ“± Cleanup Modales]
    OOOO --> SSSS[ðŸ“± Cleanup Capacitor]
    OOOO --> TTTT[ðŸ”” Cancelar Notificaciones]
    OOOO --> UUUU[ðŸŒ Cleanup Servicios de Red]
    
    PPPP --> VVVV[ðŸ’€ App Destruida]
    QQQQ --> VVVV
    RRRR --> VVVV
    SSSS --> VVVV
    TTTT --> VVVV
    UUUU --> VVVV
    
    %% Estilos
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    classDef process fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef decision fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef error fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff
    classDef ui fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    classDef data fill:#00BCD4,stroke:#00838F,stroke-width:2px,color:#fff
    classDef service fill:#FF5722,stroke:#D84315,stroke-width:2px,color:#fff
    
    class A,FF,VVVV startEnd
    class B,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,AA,BB,CC,DD,EE process
    class HH,OO,QQQ,LLLL,NNNN decision
    class C,RRR,JJJJ,KKKK,MMMM error
    class II,JJ,KK,LL,MM,NN,PP,QQ,RR,SS,TT,LLL,BBB,DDD,EEE,YYY,ZZZ,CCCC,TTT,UUU,III,JJJ,KKK ui
    class UU,FFF,VV,GGG,WW,HHH,XX,III,YY,JJJ,ZZ,KKK,MMM,NNN,OOO,PPP,SSS,TTT,UUU,VVV,WWW,XXX,OOOO,QQQQ,RRRR,SSSS,TTTT,UUUU data
    class J,K,P,Q,Y,Z,TTTT,UUUU service