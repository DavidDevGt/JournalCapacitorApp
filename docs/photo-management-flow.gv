digraph PhotoManagementFlow {
    rankdir=TB;
    node [shape=box, style=filled, color="#e0e0e0", fontname="Arial"];

    %% Inicio del Proceso
    UserTakesPhoto [label="ðŸ“· Usuario Toma Foto", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    ShowPhotoSourceModal [label="ðŸ“± Mostrar Modal\nSelecciÃ³n Fuente", fillcolor="#2196F3", color="#1565C0", fontcolor="#fff"];
    
    %% SelecciÃ³n de Fuente
    PhotoSourceChoice [label="ðŸ“¸ Â¿Fuente de\nFoto?", shape=diamond, fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    CameraSource [label="ðŸ“± CÃ¡mara", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    GallerySource [label="ðŸ–¼ï¸ GalerÃ­a", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    
    %% Captura de Foto
    TakePhoto [label="ðŸ“¸ Capturar Foto\ncon Capacitor Camera", fillcolor="#2196F3", color="#1565C0", fontcolor="#fff"];
    SelectFromGallery [label="ðŸ–¼ï¸ Seleccionar\nde GalerÃ­a", fillcolor="#2196F3", color="#1565C0", fontcolor="#fff"];
    
    %% Procesamiento de Foto
    ProcessPhotoData [label="ðŸ”„ Procesar\nDatos de Foto", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    ValidatePhoto [label="âœ… Â¿Foto\nVÃ¡lida?", shape=diamond, fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    PhotoError [label="âŒ Error en\nFoto", fillcolor="#F44336", color="#C62828", fontcolor="#fff"];
    
    %% Almacenamiento
    StorePhotoData [label="ðŸ’¾ Almacenar\nDatos de Foto", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    GenerateThumbnail [label="ðŸ–¼ï¸ Generar\nThumbnail", fillcolor="#FF5722", color="#D84315", fontcolor="#fff"];
    StoreThumbnail [label="ðŸ’¾ Almacenar\nThumbnail", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    
    %% VisualizaciÃ³n
    DisplayPhoto [label="ðŸ–¼ï¸ Mostrar Foto\nen UI", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    UpdateUI [label="ðŸŽ¨ Actualizar\nInterfaz", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    
    %% GestiÃ³n de Thumbnails
    CheckMissingThumbnails [label="ðŸ” Verificar\nThumbnails Faltantes", fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    GenerateMissingThumbnails [label="ðŸ–¼ï¸ Generar\nThumbnails Faltantes", fillcolor="#FF5722", color="#D84315", fontcolor="#fff"];
    
    %% Compartir Foto
    ShareWithPhoto [label="ðŸ“¤ Compartir\ncon Foto", fillcolor="#2196F3", color="#1565C0", fontcolor="#fff"];
    ProcessPhotoForSharing [label="ðŸ”„ Procesar Foto\npara Compartir", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    CreateTempFile [label="ðŸ“ Crear Archivo\nTemporal", fillcolor="#FF5722", color="#D84315", fontcolor="#fff"];
    ExecuteShare [label="ðŸ“¤ Ejecutar\nCompartir", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    
    %% EliminaciÃ³n
    RemovePhoto [label="ðŸ—‘ï¸ Eliminar\nFoto", fillcolor="#F44336", color="#C62828", fontcolor="#fff"];
    ClearPhotoData [label="ðŸ§¹ Limpiar\nDatos de Foto", fillcolor="#9E9E9E", color="#616161", fontcolor="#fff"];
    UpdateUIAfterRemoval [label="ðŸŽ¨ Actualizar UI\nSin Foto", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    
    %% Cleanup
    CleanupTempFiles [label="ðŸ§¹ Limpiar\nArchivos Temporales", fillcolor="#9E9E9E", color="#616161", fontcolor="#fff"];

    // Conexiones principales
    UserTakesPhoto -> ShowPhotoSourceModal;
    ShowPhotoSourceModal -> PhotoSourceChoice;
    
    PhotoSourceChoice -> CameraSource [label="ðŸ“± CÃ¡mara"];
    PhotoSourceChoice -> GallerySource [label="ðŸ–¼ï¸ GalerÃ­a"];
    
    CameraSource -> TakePhoto;
    GallerySource -> SelectFromGallery;
    
    TakePhoto -> ProcessPhotoData;
    SelectFromGallery -> ProcessPhotoData;
    
    ProcessPhotoData -> ValidatePhoto;
    ValidatePhoto -> PhotoError [label="âŒ No"];
    ValidatePhoto -> StorePhotoData [label="âœ… SÃ­"];
    
    StorePhotoData -> GenerateThumbnail;
    GenerateThumbnail -> StoreThumbnail;
    StoreThumbnail -> DisplayPhoto;
    DisplayPhoto -> UpdateUI;
    
    // GestiÃ³n de thumbnails faltantes
    UpdateUI -> CheckMissingThumbnails;
    CheckMissingThumbnails -> GenerateMissingThumbnails;
    
    // Compartir con foto
    ShareWithPhoto -> ProcessPhotoForSharing;
    ProcessPhotoForSharing -> CreateTempFile;
    CreateTempFile -> ExecuteShare;
    ExecuteShare -> CleanupTempFiles;
    
    // EliminaciÃ³n
    RemovePhoto -> ClearPhotoData;
    ClearPhotoData -> UpdateUIAfterRemoval;
    
    // Estilos
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    classDef process fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef decision fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef error fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff
    classDef ui fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    classDef data fill:#00BCD4,stroke:#00838F,stroke-width:2px,color:#fff
    classDef service fill:#FF5722,stroke:#D84315,stroke-width:2px,color:#fff
    
    class UserTakesPhoto startEnd
    class ShowPhotoSourceModal,TakePhoto,SelectFromGallery,ProcessPhotoData,StorePhotoData,StoreThumbnail,ProcessPhotoForSharing,CreateTempFile,ExecuteShare,ClearPhotoData,CleanupTempFiles process
    class PhotoSourceChoice,ValidatePhoto decision
    class PhotoError error
    class CameraSource,GallerySource,DisplayPhoto,UpdateUI,ShareWithPhoto,RemovePhoto,UpdateUIAfterRemoval ui
    class GenerateThumbnail,CheckMissingThumbnails,GenerateMissingThumbnails data
    class service service
} 