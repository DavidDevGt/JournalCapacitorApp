digraph NotificationFlow {
    rankdir=TB;
    node [shape=box, style=filled, color="#e0e0e0", fontname="Arial"];

    %% InicializaciÃ³n del Servicio
    AppStart [label="ðŸš€ Inicio de la App", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    InitNotificationService [label="ðŸ”” Inicializar\nNotificationService", fillcolor="#2196F3", color="#1565C0", fontcolor="#fff"];
    RequestPermissions [label="ðŸ“‹ Solicitar Permisos\nLocalNotifications", fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    
    %% VerificaciÃ³n de Permisos
    CheckPermissions [label="âœ… Â¿Permisos\nConcedidos?", shape=diamond, fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    PermissionsDenied [label="âŒ Permisos Denegados\nLog Warning", fillcolor="#F44336", color="#C62828", fontcolor="#fff"];
    PermissionsGranted [label="âœ… Permisos Concedidos\nServicio Activo", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    
    %% ConfiguraciÃ³n de Notificaciones
    GetNotificationSettings [label="âš™ï¸ Obtener ConfiguraciÃ³n\n(Enabled, Time)", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    CheckNotificationsEnabled [label="ðŸ”” Â¿Notificaciones\nHabilitadas?", shape=diamond, fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    NotificationsDisabled [label="â¸ï¸ Notificaciones\nDeshabilitadas", fillcolor="#9E9E9E", color="#616161", fontcolor="#fff"];
    
    %% ProgramaciÃ³n de Notificaciones
    GetNotificationTime [label="ðŸ• Obtener Hora\nConfigurada", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    GetRandomPhrase [label="ðŸ’­ Obtener Frase\nAleatoria por Hora", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    ScheduleNotification [label="ðŸ“… Programar\nNotificaciÃ³n Diaria", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    
    %% Manejo de Frases por Hora
    CheckCurrentTime [label="ðŸ• Determinar\nPerÃ­odo del DÃ­a", fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    MorningPhrases [label="ðŸŒ… Frases de\nMaÃ±ana", fillcolor="#FFEB3B", color="#F57F17", fontcolor="#000"];
    AfternoonPhrases [label="ðŸŒž Frases de\nTarde", fillcolor="#FF9800", color="#E65100", fontcolor="#fff"];
    EveningPhrases [label="ðŸŒ† Frases de\nNoche", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    NightPhrases [label="ðŸŒ™ Frases de\nMadrugada", fillcolor="#3F51B5", color="#283593", fontcolor="#fff"];
    
    %% InteracciÃ³n del Usuario
    UserInteraction [label="ðŸ‘† Usuario InteractÃºa\ncon Notificaciones", fillcolor="#9C27B0", color="#6A1B9A", fontcolor="#fff"];
    ToggleNotifications [label="ðŸ”„ Activar/Desactivar\nNotificaciones", fillcolor="#FF5722", color="#D84315", fontcolor="#fff"];
    ChangeNotificationTime [label="ðŸ• Cambiar Hora\nde NotificaciÃ³n", fillcolor="#FF5722", color="#D84315", fontcolor="#fff"];
    
    %% Procesamiento de Cambios
    UpdateSettings [label="ðŸ’¾ Actualizar\nConfiguraciÃ³n", fillcolor="#00BCD4", color="#00838F", fontcolor="#fff"];
    RescheduleNotifications [label="ðŸ“… Reprogramar\nNotificaciones", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    CancelNotifications [label="âŒ Cancelar\nNotificaciones", fillcolor="#F44336", color="#C62828", fontcolor="#fff"];
    
    %% NotificaciÃ³n Recibida
    NotificationReceived [label="ðŸ“± Usuario Recibe\nNotificaciÃ³n", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    HandleNotificationTap [label="ðŸ‘† Manejar Tap\nen NotificaciÃ³n", fillcolor="#2196F3", color="#1565C0", fontcolor="#fff"];
    OpenApp [label="ðŸš€ Abrir App\nen Fecha Actual", fillcolor="#4CAF50", color="#2E7D32", fontcolor="#fff"];
    
    %% Cleanup
    AppDestroy [label="ðŸ’€ App se Destruye", fillcolor="#F44336", color="#C62828", fontcolor="#fff"];
    CleanupNotifications [label="ðŸ§¹ Limpiar\nNotificaciones", fillcolor="#9E9E9E", color="#616161", fontcolor="#fff"];

    // Conexiones principales
    AppStart -> InitNotificationService;
    InitNotificationService -> RequestPermissions;
    RequestPermissions -> CheckPermissions;
    
    CheckPermissions -> PermissionsDenied [label="âŒ No"];
    CheckPermissions -> PermissionsGranted [label="âœ… SÃ­"];
    
    PermissionsGranted -> GetNotificationSettings;
    GetNotificationSettings -> CheckNotificationsEnabled;
    
    CheckNotificationsEnabled -> NotificationsDisabled [label="âŒ No"];
    CheckNotificationsEnabled -> GetNotificationTime [label="âœ… SÃ­"];
    
    GetNotificationTime -> CheckCurrentTime;
    CheckCurrentTime -> MorningPhrases [label="5-12h"];
    CheckCurrentTime -> AfternoonPhrases [label="12-18h"];
    CheckCurrentTime -> EveningPhrases [label="18-23h"];
    CheckCurrentTime -> NightPhrases [label="23-5h"];
    
    MorningPhrases -> GetRandomPhrase;
    AfternoonPhrases -> GetRandomPhrase;
    EveningPhrases -> GetRandomPhrase;
    NightPhrases -> GetRandomPhrase;
    
    GetRandomPhrase -> ScheduleNotification;
    
    // Interacciones del usuario
    UserInteraction -> ToggleNotifications;
    UserInteraction -> ChangeNotificationTime;
    
    ToggleNotifications -> UpdateSettings;
    ChangeNotificationTime -> UpdateSettings;
    
    UpdateSettings -> RescheduleNotifications;
    UpdateSettings -> CancelNotifications;
    
    // RecepciÃ³n de notificaciÃ³n
    ScheduleNotification -> NotificationReceived;
    NotificationReceived -> HandleNotificationTap;
    HandleNotificationTap -> OpenApp;
    
    // Cleanup
    AppDestroy -> CleanupNotifications;
    
    // Estilos
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    classDef process fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef decision fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef error fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff
    classDef ui fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    classDef data fill:#00BCD4,stroke:#00838F,stroke-width:2px,color:#fff
    classDef service fill:#FF5722,stroke:#D84315,stroke-width:2px,color:#fff
    
    class AppStart,AppDestroy startEnd
    class InitNotificationService,RequestPermissions,GetNotificationSettings,GetNotificationTime,GetRandomPhrase,ScheduleNotification,UpdateSettings,RescheduleNotifications,CancelNotifications,HandleNotificationTap,OpenApp,CleanupNotifications process
    class CheckPermissions,CheckNotificationsEnabled,CheckCurrentTime decision
    class PermissionsDenied,NotificationsDisabled error
    class UserInteraction,ToggleNotifications,ChangeNotificationTime,NotificationReceived ui
    class PermissionsGranted,MorningPhrases,AfternoonPhrases,EveningPhrases,NightPhrases data
    class service service
} 